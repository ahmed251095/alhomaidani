<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <!-- Inject into BI modern sale order template -->
    <template id="inject_html_bi" inherit_id="bi_professional_reports_templates.modern_report_saleorder_document">
      <!-- بعد شروط الدفع مباشرة -->
      <xpath expr="//p[span[@t-field='doc.payment_term_id']]" position="after">
        <t t-if="doc.extra_print_html">
          <div class="oe_structure" style="margin-top: 10px; page-break-inside: avoid;">
            <t t-raw="doc.extra_print_html"/>
          </div>
        </t>
      </xpath>

      <!--Fallback: لو مفيش شروط دفع، ضعه قبل آخر oe_structure -->
      <xpath expr="(//div[@class='oe_structure'])[last()]" position="before">
        <t t-if="not doc.payment_term_id and doc.extra_print_html">
          <div class="oe_structure" style="margin-top: 10px; page-break-inside: avoid;">
            <t t-raw="doc.extra_print_html"/>
          </div>
        </t>
      </xpath>
    </template>
  </data>
</odoo>
