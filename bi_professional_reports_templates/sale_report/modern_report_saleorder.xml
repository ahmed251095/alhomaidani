<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <template id="modern_report_saleorder_document" name="Modern Sale Order RTL">
      <!-- الشركة -->
      <t t-set="company" t-value="(doc and doc.company_id) or res_company"/>

      <!-- إطار التقرير القياسي -->
      <t t-call="web.external_layout">
        <!-- توحيد اللغة حسب لغة الشريك -->
        <t t-set="doc" t-value="doc.with_context({'lang': doc.partner_id.lang})"/>

        <!-- كل صفحة التقرير داخل div.page -->
        <div class="page" style="direction: rtl; text-align: right; font-family: 'Times New Roman', Times, serif;">

          <div class="oe_structure"/>

          <!-- الغلاف -->
          <div style="margin: 0 0 12px 0;">
            <t t-if="doc.company_id.sale_report_cover">
              <img t-att-src="'/web/image/res.company/%s/sale_report_cover' % doc.company_id.id"
                   style="width:100%; height:auto; display:block;"/>
            </t>
            <t t-else="">
              <img src="/company_sale_report_cover/static/src/img/default_cover.jpg"
                   style="width:100%; height:auto; display:block;"/>
            </t>
          </div>

          <table class="table table-sm table-borderless" style="table-layout:fixed; direction: rtl; text-align: right;">
            <thead>
              <tr>
                <th width="30%" t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'}; text-align: center;"><strong>العميل</strong></th>
                <th width="15%" t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'}; text-align: center;"><strong>تاريخ العرض</strong></th>
                <th width="20%" t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'}; text-align: center;"><strong>رقم العرض</strong></th>
                <th width="40%" t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'}; text-align: center;"><strong>نوع المنتجات والخدمات</strong></th>
              </tr>
            </thead>
            <tbody class="sale_tbody">
              <tr class="text-center">
                <td><span t-field="doc.partner_id"/></td>
                <td class="text-center"><span t-field="doc.date_order" t-options="{'widget': 'date'}"/></td>
                <td class="text-center"><span t-field="doc.name"/></td>
                <td class="text-center"><span t-field="doc.service_type_id"/></td>
              </tr>
            </tbody>
          </table>


          <div style="direction: rtl; text-align: right;">
            <t t-if="doc.extra_print_html">
              <div class="oe_structure" style="margin-top:10px; page-break-inside: avoid;">
                <t t-raw="doc.extra_print_html"/>
              </div>
            </t>
          </div>

          <!-- جدول بيانات عامة -->
           <table class="table table-sm table-borderless" style="table-layout:fixed; direction: rtl; text-align: right;">
            <thead>
              <tr>
                <th width="30%" t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'}; text-align: center;"><strong>العميل</strong></th>
                <th width="15%" t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'}; text-align: center;"><strong>تاريخ العرض</strong></th>
                <th width="20%" t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'}; text-align: center;"><strong>رقم العرض</strong></th>
                <th width="40%" t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'}; text-align: center;"><strong>نوع المنتجات والخدمات</strong></th>
              </tr>
            </thead>
            <tbody class="sale_tbody">
              <tr class="text-center">
                <td><span t-field="doc.partner_id"/></td>
                <td class="text-center"><span t-field="doc.date_order" t-options="{'widget': 'date'}"/></td>
                <td class="text-center"><span t-field="doc.name"/></td>
                <td class="text-center"><span t-field="doc.service_type_id"/></td>
              </tr>
            </tbody>
          </table>


          <!-- هل يوجد خصم -->
          <t t-set="display_discount" t-value="any([l.discount for l in doc.order_line])"/>

          <!-- جدول البنود -->
          <table class="table table-sm table-borderless" style="direction: rtl; text-align: right;">
            <thead>
              <tr>
                <th t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'}; text-align: center;" ><strong>الوصف</strong></th>
                <th t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'}; text-align: center;"><strong>الكمية</strong></th>
                <th t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'}; text-align: center;"><strong>السعر</strong></th>
                <th t-if="display_discount" t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'}; text-align: center;" groups="sale.group_discount_per_so_line"><strong>الخصم</strong></th>
                <th t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'}; text-align: center;"><strong>الضريبة</strong></th>
                <th t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'}; text-align: center;"><strong>الإجمالى</strong></th>
              </tr>
            </thead>
            <tbody>
              <t t-foreach="doc.order_line" t-as="l">
                <tr t-if="l.product_uom_qty">
                  <td><span t-field="l.name"/></td>
                  <td class="text-center">
                    <span t-field="l.product_uom_qty"/>
                    <span groups="product.group_uom" t-field="l.product_uom"/>
                  </td>
                  <td class="text-center"><span t-field="l.price_unit"/></td>
                  <td t-if="display_discount" class="text-center" groups="sale.group_discount_per_so_line"><span t-field="l.discount"/></td>
                  <td class="text-center"><span t-esc="', '.join([(t.description or t.name) for t in l.tax_id])"/></td>
                  <td class="text-center"><span t-field="l.price_subtotal"/></td>
                </tr>
              </t>
            </tbody>
          </table>

          <br/>

          <!-- الإجماليات -->
          <div name="total" class="float-start" style="direction: rtl; text-align: right; width: 350px;">
            <table class="table table-condensed table-borderless">
              <tr class="border-black">
                <td t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'};"><strong>الإجمالى قبل الضريبة</strong></td>
                <td class="text-center"><span t-field="doc.amount_untaxed"/></td>
              </tr>
              <tr>
                <td t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'};">الضريبة</td>
                <td class="text-center"><span t-field="doc.amount_tax"/></td>
              </tr>
              <tr class="border-black">
                <td t-attf-style="background-color: #{company.color_sale or 'transparent'}; color: #{company.text_color_sale or '#000'};"><strong>الإجمالى بعد الضريبة</strong></td>
                <td class="text-center"><span t-field="doc.amount_total"/></td>
              </tr>
            </table>
          </div>

          <!-- الملاحظات -->
          <div style="direction: rtl; text-align: right;">
            <p t-if="doc.note">
              <strong>ملاحظات: </strong>
              <span t-field="doc.note"/>
            </p>
            <p t-if="doc.payment_term_id">
              <strong>شروط الدفع: </strong>
              <span t-field="doc.payment_term_id"/>
            </p>
            <!-- <t t-if="doc.extra_print_html">
              <div class="oe_structure" style="margin-top:10px; page-break-inside: avoid;">
                <t t-raw="doc.extra_print_html"/>
              </div>
            </t> -->
          </div>

          <div class="oe_structure"/>
        </div> <!-- /page -->
      </t> <!-- /web.external_layout -->
    </template>
  </data>
</odoo>
