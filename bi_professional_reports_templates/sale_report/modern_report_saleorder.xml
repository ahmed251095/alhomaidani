<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <template id="modern_report_saleorder_document" name="Modern Sale Order">
      <!-- شركة التقرير -->
      <t t-set="company" t-value="(doc and doc.company_id) or res_company"/>

      <t t-call="web.external_layout">
        <t t-set="doc" t-value="doc.with_context({'lang': doc.partner_id.lang})"/>
        <div class="page">
          <div class="oe_structure"/>

          <!-- الهيدر اختياري: لو عايزه خليه فوق external_layout_header بدل هنا -->

          <!-- جدول بيانات عامة -->
          <table class="table table-sm table-borderless" style="table-layout:fixed;">
            <thead>
              <tr>
                <th width="20px"
                    t-attf-style="background-color: #{company.color_sale or 'transparent'} !important; color: #{company.text_color_sale or '#000'} !important; text-align: center;">
                  العميل
                </th>
                <th width="20px"
                    t-attf-style="background-color: #{company.color_sale or 'transparent'} !important; color: #{company.text_color_sale or '#000'} !important;text-align: center;">
                  تاريخ العرض
                </th>
                <th width="20px"
                    t-attf-style="background-color: #{company.color_sale or 'transparent'} !important; color: #{company.text_color_sale or '#000'} !important;text-align: center;">
                  رقم العرض
                </th>
                <th width="40px"
                    t-attf-style="background-color: #{company.color_sale or 'transparent'} !important; color: #{company.text_color_sale or '#000'} !important;text-align: center;">
                  نوع المنتجات والخدمات
                </th>
              </tr>
            </thead>
            <tbody class="sale_tbody">
              <tr>
                <td><strong><span t-field="doc.partner_id"/></strong></td>
                <td class="text-center"><strong><span t-field="doc.date_order" t-options="{'widget': 'date'}"/></strong></td>
                <td class="text-center"><strong><span t-field="doc.name"/></strong></td>
                <td t-attf-style="text-align: right;"><strong><span t-field="doc.service_type_id"/></strong></td>
              </tr>
            </tbody>
          </table>

          <!-- هل يوجد خصم بأي سطر؟ -->
          <t t-set="display_discount" t-value="any([l.discount for l in doc.order_line])"/>

          <!-- جدول البنود -->
          <table class="table table-sm table-borderless">
            <thead>
              <tr>
                <th t-attf-style="background-color: #{company.color_sale or 'transparent'} !important; color: #{company.text_color_sale or '#000'} !important;">
                  الوصف
                </th>
                <th class="text-right"
                    t-attf-style="background-color: #{company.color_sale or 'transparent'} !important; color: #{company.text_color_sale or '#000'} !important;">
                  الكمية
                </th>
                <th class="text-right"
                    t-attf-style="background-color: #{company.color_sale or 'transparent'} !important; color: #{company.text_color_sale or '#000'} !important;">
                  السعر
                </th>
                <th t-if="display_discount" class="text-right" groups="sale.group_discount_per_so_line"
                    t-attf-style="background-color: #{company.color_sale or 'transparent'} !important; color: #{company.text_color_sale or '#000'} !important;">
                  الخصم
                </th>
                <th class="text-right"
                    t-attf-style="background-color: #{company.color_sale or 'transparent'} !important; color: #{company.text_color_sale or '#000'} !important;">
                  الضريبة
                </th>
                <th class="text-right"
                    t-attf-style="background-color: #{company.color_sale or 'transparent'} !important; color: #{company.text_color_sale or '#000'} !important;">
                  الاجمالى
                </th>
              </tr>
            </thead>
            <tbody class="sale_tbody">
              <t t-foreach="doc.order_line" t-as="l">
                <tr t-if="l.product_uom_qty">
                  <td><span t-field="l.name"/></td>
                  <td class="text-center">
                    <span t-field="l.product_uom_qty"/>
                    <span groups="product.group_uom" t-field="l.product_uom"/>
                  </td>
                  <td class="text-center"><span t-field="l.price_unit"/></td>
                  <td t-if="display_discount" class="text-center" groups="sale.group_discount_per_so_line"><span t-field="l.discount"/></td>
                  <td class="text-center"><span t-esc="', '.join([(t.description or t.name) for t in l.tax_id])"/></td>
                  <td class="text-center"><span t-field="l.price_subtotal"/></td>
                </tr>
              </t>
            </tbody>
          </table>

          <br/>

          <!-- الإجماليات -->
          <div name="total" class="float-end" style="position: absolute; left: 590px;">
            <div class="col-4 pull-right" style="width: 260px;">
              <table class="table table-condensed table-borderless">
                <tr class="border-black">
                  <td><strong>الاجمالى قبل الضريبة</strong></td>
                  <td class="text-right"><span t-field="doc.amount_untaxed"/></td>
                </tr>
                <tr>
                  <td>الضريبة</td>
                  <td class="text-right"><span t-field="doc.amount_tax"/></td>
                </tr>
                <tr class="border-black">
                  <td t-attf-style="background-color: #{company.color_sale or 'transparent'} !important; color: #{company.text_color_sale or '#000'} !important;">
                    <strong>الاجمالى بعد الضريبة</strong>
                  </td>
                  <td class="text-right"
                      t-attf-style="background-color: #{company.color_sale or 'transparent'} !important; color: #{company.text_color_sale or '#000'} !important;">
                    <span t-field="doc.amount_total"/>
                  </td>
                </tr>
              </table>
            </div>
          </div>

          <!-- ملاحظات وشروط الدفع -->
          <div t-attf-style="background-color: #{company.color_sale or 'transparent'} !important; color: #{company.text_color_sale or '#000'} !important; font:15px lucida-console,sans-serif !important;">
            <p t-if="doc.note">
              <strong><span>Note:</span></strong>
              <span t-field="doc.note"/>
            </p>
          </div>

          <div t-attf-style="background-color: #{company.color_sale or 'transparent'} !important; color: #{company.text_color_sale or '#000'} !important; font:15px lucida-console,sans-serif !important;">
            <p t-if="doc.payment_term_id">
              <strong><span>Payment Term :</span></strong>
              <span t-field="doc.payment_term_id"/>
            </p>
          </div>

          <div class="oe_structure"/>
        </div>
      </t>
    </template>
  </data>
</odoo>
